<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Leaflet Map</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <style>
      html, body, #map {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
<p>
  <a id="redirect-link" style="display:none; font-weight: bold;" href="#">Go to Grafana</a>
</p>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
   <script>
  let selectedLat = null;
  let selectedLon = null;

  function initMap() {
    const urlParams = new URLSearchParams(window.location.search);
    const lat = parseFloat(urlParams.get('var-latitude')) || 37.7749;
    const lon = parseFloat(urlParams.get('var-longitude')) || -122.4194;

    const map = L.map('map').setView([lat, lon], 12);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    const marker = L.marker([lat, lon]).addTo(map)
      .bindPopup("Selected Point")
      .openPopup();

    map.on('click', function(e) {
      selectedLat = e.latlng.lat.toFixed(6);
      selectedLon = e.latlng.lng.toFixed(6);
      marker.setLatLng([selectedLat, selectedLon]);
      marker.getPopup().setContent(`Lat: ${selectedLat}, Lon: ${selectedLon}`);
      marker.openPopup();

      // Show redirect link
      const redirectLink = document.getElementById("redirect-link");
      redirectLink.href = `https://your-grafana-url/dashboard-name?var-latitude=${selectedLat}&var-longitude=${selectedLon}`;
      redirectLink.style.display = "inline-block";
    });
  }
</script>

  </body>
</html>
